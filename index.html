<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>WG Quest Board</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* Modernes, iOS-freundliches Design */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #fdfbfb, #ebedee);
            margin: 0;
            padding: 15px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            color: #333;
        }

        h1 {
            text-align: center;
            font-size: 24px;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* Tab Navigation (Aufgaben / Statistiken) */
        .tabs {
            display: flex;
            background: #e3e3e8;
            border-radius: 9px;
            padding: 3px;
            margin-bottom: 20px;
        }

        .tabs button {
            flex: 1;
            background: transparent;
            border: none;
            padding: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #000;
            border-radius: 7px;
            cursor: pointer;
            transition: 0.2s;
        }

        .tabs button.active {
            background: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* √úbersicht der Punkte */
        .scores {
            display: flex;
            justify-content: space-between;
            background: white;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 15px;
        }

        /* Styling der einzelnen Aufgaben */
        .task, .stat-item {
            background: white;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .task-info { flex-grow: 1; }

        .meta {
            font-size: 12px;
            opacity: 0.6;
            margin-top: 4px;
        }

        /* Anzeige, wer die Aufgabe zuletzt gemacht hat */
        .last-done-badge {
            display: inline-block;
            background: #f0f0f5;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 6px;
            font-weight: 600;
        }

        /* Buttons f√ºr Maria und Valentin */
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task button {
            border: none;
            border-radius: 10px;
            padding: 10px 14px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .maria { background: #ff2d55; }
        .valentin { background: #5856d6; }

        /* Farb-Indikatoren an der Seite */
        .fresh { border-left: 6px solid #34c759; }
        .ok { border-left: 6px solid #ff9500; }
        .old { border-left: 6px solid #ff3b30; }
        .cooldown { opacity: 0.5; pointer-events: none; } /* Wenn im Cooldown, kann nicht geklickt werden */

        /* Button zum Zur√ºcksetzen */
        .reset-btn {
            display: block;
            width: 100%;
            background: #8e8e93;
            color: white;
            margin-top: 30px;
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>üèÜ WG Quest Board</h1>

    <div class="scores">
        <div>Maria: <br><span id="scoreMaria">0</span> XP</div>
        <div style="text-align:center;">WG:<br><span id="scoreWG">0</span> XP</div>
        <div style="text-align:right;">Valentin:<br><span id="scoreValentin">0</span> XP</div>
    </div>

    <div class="tabs">
        <button id="tabBtnTasks" class="active" onclick="switchTab('tasks')">üìã Aufgaben</button>
        <button id="tabBtnStats" onclick="switchTab('stats')">üìä Statistiken</button>
    </div>

    <div id="viewTasks"></div>
    <div id="viewStats" style="display: none;"></div>

    <button class="reset-btn" onclick="resetStats()">‚ö†Ô∏è Alle Statistiken auf Null setzen</button>

<script>
    // ==========================================
    // 1. FIREBASE KONFIGURATION (Deine Daten!)
    // ==========================================
    const firebaseConfig = {
        apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
        authDomain: "wg-quest.firebaseapp.com",
        // HINWEIS: Realtime Database URL
        databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "wg-quest",
        storageBucket: "wg-quest.firebasestorage.app",
        messagingSenderId: "171906625585",
        appId: "1:171906625585:web:d7c618e3d7b70e72a2a510"
    };

    // Firebase initialisieren
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // ==========================================
    // 2. DATEN & LOGIK DER AUFGABEN
    // ==========================================
    const tasks = [
        { name: "Staubsaugen", emoji: "üßπ", points: 15, cooldown: 24 },
        { name: "Wischen", emoji: "ü™£", points: 20, cooldown: 48 },
        { name: "Staubwischen", emoji: "üßΩ", points: 10, cooldown: 24 },
        { name: "Bad putzen", emoji: "üöΩ", points: 25, cooldown: 72 },
        { name: "Fenster putzen", emoji: "ü™ü", points: 30, cooldown: 168 },
        { name: "Sp√ºli einr√§umen", emoji: "üçΩÔ∏è", points: 5, cooldown: 6 },
        { name: "Sp√ºli ausr√§umen", emoji: "‚ú®", points: 5, cooldown: 6 },
        { name: "M√ºll raus", emoji: "üóëÔ∏è", points: 10, cooldown: 24 },
        { name: "W√§sche rein", emoji: "üß∫", points: 10, cooldown: 12 },
        { name: "W√§sche aufh√§ngen", emoji: "üëï", points: 10, cooldown: 12 },
        { name: "W√§sche abh√§ngen", emoji: "üëö", points: 10, cooldown: 12 },
        { name: "Aufr√§umen", emoji: "üì¶", points: 15, cooldown: 24 }
    ];

    let dbData = { scores: {}, tasks: {} };

    // Firebase Listener f√ºr Echtzeit-Synchronisation
    db.ref("/").on("value", snap => {
        dbData = snap.val() || { scores: {}, tasks: {} };
        updateScores();
        renderTasks();
        renderStats();
    });

    // Hilfsfunktion: Berechnet die verstrichene Zeit
    function timeAgo(ts) {
        if (!ts) return "Noch nie";
        const diff = Date.now() - ts;
        const h = Math.floor(diff / 3600000);
        const d = Math.floor(h / 24);
        if (d > 0) return `vor ${d} Tag(en)`;
        if (h > 0) return `vor ${h} Std.`;
        return "Gerade eben";
    }

    // Funktion zum Wechseln zwischen Aufgaben und Statistiken
    function switchTab(tab) {
        document.getElementById("viewTasks").style.display = tab === 'tasks' ? 'block' : 'none';
        document.getElementById("viewStats").style.display = tab === 'stats' ? 'block' : 'none';
        document.getElementById("tabBtnTasks").className = tab === 'tasks' ? 'active' : '';
        document.getElementById("tabBtnStats").className = tab === 'stats' ? 'active' : '';
    }

    // Aufgabe in Firebase als erledigt markieren
    function markDone(taskName, person) {
        const now = Date.now();
        const task = tasks.find(t => t.name === taskName);
        const taskData = dbData.tasks?.[taskName] || {};
        const lastOverall = Math.max(taskData.Maria_last || 0, taskData.Valentin_last || 0);
        
        if (now - lastOverall < task.cooldown * 3600000) {
            alert(`‚è≥ Noch nicht! Die Aufgabe bringt erst in ${task.cooldown}
