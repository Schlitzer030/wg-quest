<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WG Quest Board ğŸ </title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f2f2f2;
    padding: 20px;
  }

  h1 { text-align: center; }

  .scores {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
  }

  .task {
    background: white;
    padding: 14px;
    margin-bottom: 12px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }

  .meta {
    font-size: 13px;
    margin-top: 4px;
  }

  .status {
    padding: 4px 8px;
    border-radius: 8px;
    display: inline-block;
    margin-top: 4px;
    font-size: 12px;
  }

  button {
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    color: white;
    font-size: 13px;
  }

  .maria { background: #e91e63; }
  .valentin { background: #3f51b5; }
</style>
</head>

<body>

<h1>ğŸ  WG Quest Board</h1>

<div class="scores">
  <div>ğŸ‘© Maria â­ <span id="scoreMaria">0</span></div>
  <div>ğŸ¤ WG â­ <span id="scoreWG">0</span></div>
  <div>ğŸ‘¨ Valentin â­ <span id="scoreValentin">0</span></div>
</div>

<div id="tasks"></div>

<script>
/* ğŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
  authDomain: "wg-quest.firebaseapp.com",
  databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wg-quest",
  storageBucket: "wg-quest.appspot.com",
  messagingSenderId: "171906625585",
  appId: "1:171906625585:web:d7c618e3d7b70e72a2a510"
});

const db = firebase.database();

/* ğŸ§¹ AUFGABEN */
const tasks = [
  ["Wischen","ğŸª£"],["Staub wischen","ğŸ§½"],["Bad putzen","ğŸš¿"],["Fenster putzen","ğŸªŸ"],
  ["SpÃ¼lmaschine einrÃ¤umen","ğŸ½ï¸"],["SpÃ¼lmaschine ausrÃ¤umen","ğŸ¥„"],["MÃ¼ll rausbringen","ğŸ—‘ï¸"],
  ["WÃ¤sche reinstecken","ğŸ§º"],["WÃ¤sche aufhÃ¤ngen","ğŸ‘•"],["WÃ¤sche abhÃ¤ngen","ğŸ§¦"],
  ["AufrÃ¤umen (GemeinschaftsflÃ¤chen)","ğŸ“¦"],
  ["GlasmÃ¼ll rausbringen","ğŸ¾"],["Bett beziehen","ğŸ›ï¸"],["Pfand wegbringen","â™»ï¸"],
  ["Waschmaschine reinigen","ğŸ§¼"],["SpÃ¼lmaschine reinigen","ğŸ§½"],
  ["KÃ¼hlschrank auswischen","â„ï¸"],["KÃ¼chenablagen wischen","ğŸ³"],
  ["Einkaufen","ğŸ›’"],["Kochen","ğŸ²"],["Blumen gieÃŸen","ğŸŒ¸"],["Deep Clean","ğŸ§¨"]
].map(t => ({ name:t[0], emoji:t[1], points:15 }));

/* â±ï¸ Helfer */
function days(ts){
  if(!ts) return 999;
  return Math.floor((Date.now()-ts)/(1000*60*60*24));
}

function color(days){
  if(days<=1) return "#4caf50";
  if(days<=3) return "#8bc34a";
  if(days<=6) return "#ffeb3b";
  if(days<=9) return "#ff9800";
  if(days<=19) return "#f44336";
  return "#8b0000";
}

function fmt(ts){
  if(!ts) return "noch nie";
  const d=new Date(ts);
  return d.toLocaleDateString("de-DE")+" "+d.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"});
}

/* âœ”ï¸ ERLEDIGT */
function done(task, person){
  const now=Date.now();
  db.ref(`tasks/${task.name}/${person}`).set({ last:now });
  db.ref(`scores/${person}`).transaction(v=>(v||0)+task.points);
  db.ref(`scores/WG`).transaction(v=>(v||0)+task.points);
}

/* ğŸ”„ RENDER */
db.ref("/").on("value", snap=>{
  const d=snap.val()||{};
  scoreMaria.innerText=d.scores?.Maria||0;
  scoreValentin.innerText=d.scores?.Valentin||0;
  scoreWG.innerText=d.scores?.WG||0;

  tasksDiv.innerHTML="";
  tasks.forEach(t=>{
    const m=d.tasks?.[t.name]?.Maria?.last;
    const v=d.tasks?.[t.name]?.Valentin?.last;

    const md=days(m), vd=days(v);

    const el=document.createElement("div");
    el.className="task";
    el.innerHTML=`
      <div>
        <strong>${t.emoji} ${t.name}</strong>
        <div class="meta">
          ğŸ‘© ${fmt(m)}
          <div class="status" style="background:${color(md)}">vor ${md} Tagen</div><br>
          ğŸ‘¨ ${fmt(v)}
          <div class="status" style="background:${color(vd)}">vor ${vd} Tagen</div>
        </div>
      </div>
      <div>
        <button class="maria" onclick='done(${JSON.stringify(t)},"Maria")'>Maria âœ”</button><br><br>
        <button class="valentin" onclick='done(${JSON.stringify(t)},"Valentin")'>Valentin âœ”</button>
      </div>`;
    tasksDiv.appendChild(el);
  });
});

const tasksDiv=document.getElementById("tasks");
</script>

</body>
</html>
