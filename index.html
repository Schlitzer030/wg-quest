<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WG Quest Board üè†</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f2f2f2;
  margin:0;
  padding:0;
}
h1 { text-align:center; margin:10px 0; }

.tabs {
  display:flex;
  justify-content:space-around;
  margin:10px 0;
}

.tab {
  flex:1;
  padding:10px;
  text-align:center;
  background:#ddd;
  cursor:pointer;
  font-weight:bold;
}

.tab.active {
  background:#bbb;
}

#content {
  padding:10px;
}

.task {
  background:white;
  padding:12px;
  margin-bottom:10px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  gap: 10px;
}

.task .meta {
  font-size:12px;
  margin-top:4px;
}

.status {
  display:inline-block;
  padding:2px 6px;
  border-radius:6px;
  font-size:11px;
  color:white;
  margin-top:2px;
}

button {
  border:none;
  border-radius:8px;
  padding:6px 10px;
  margin-top:4px;
  width:100%;
  font-size:13px;
  color:white;
}

.maria { background:#e91e63; }
.valentin { background:#3f51b5; }

table {
  width:100%;
  border-collapse: collapse;
}
th,td {
  padding:6px;
  text-align:left;
  border-bottom:1px solid #ccc;
  font-size:13px;
}

.reset-btn {
  width:100%;
  padding:8px;
  margin-bottom:10px;
  background:#f44336;
  color:white;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>üè† WG Quest</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab('tasksTab')">Aufgaben</div>
  <div class="tab" onclick="showTab('statsTab')">Statistiken</div>
</div>

<div id="content">
  <div id="tasksTab"></div>
  <div id="statsTab" style="display:none"></div>
</div>

<script>
/* üî• Firebase */
firebase.initializeApp({
  apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
  authDomain: "wg-quest.firebaseapp.com",
  databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wg-quest",
  storageBucket: "wg-quest.appspot.com",
  messagingSenderId: "171906625585",
  appId: "1:171906625585:web:d7c618e3d7b70e72a2a510"
});
const db=firebase.database();

/* üßπ Aufgaben */
const tasks = [
  ["Wischen","ü™£"],["Staub wischen","üßΩ"],["Bad putzen","üöø"],["Fenster putzen","ü™ü"],
  ["Sp√ºlmaschine einr√§umen","üçΩÔ∏è"],["Sp√ºlmaschine ausr√§umen","ü•Ñ"],["M√ºll rausbringen","üóëÔ∏è"],
  ["W√§sche reinstecken","üß∫"],["W√§sche aufh√§ngen","üëï"],["W√§sche abh√§ngen","üß¶"],
  ["Aufr√§umen (Gemeinschaftsfl√§chen)","üì¶"],
  ["Glasm√ºll rausbringen","üçæ"],["Bett beziehen","üõèÔ∏è"],["Pfand wegbringen","‚ôªÔ∏è"],
  ["Waschmaschine reinigen","üßº"],["Sp√ºlmaschine reinigen","üßΩ"],
  ["K√ºhlschrank auswischen","‚ùÑÔ∏è"],["K√ºchenablagen wischen","üç≥"],
  ["Einkaufen","üõí"],["Kochen","üç≤"],["Blumen gie√üen","üå∏"],["Deep Clean","üß®"]
].map(t=>({name:t[0],emoji:t[1],points:15}));

/* Helfer */
function days(ts){ if(!ts) return 999; return Math.floor((Date.now()-ts)/(1000*60*60*24)); }
function color(days){
  if(days<=1) return "#4caf50";
  if(days<=3) return "#8bc34a";
  if(days<=6) return "#ffeb3b";
  if(days<=9) return "#ff9800";
  if(days<=19) return "#f44336";
  return "#8b0000";
}
function fmt(ts){ if(!ts) return "noch nie"; const d=new Date(ts); return d.toLocaleDateString("de-DE")+" "+d.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}); }

/* ‚úîÔ∏è Aufgabe erledigt */
function done(task,person){
  const now=Date.now();
  db.ref(`tasks/${task.name}/${person}`).set({ last:now });
  db.ref(`scores/${person}`).transaction(v=>(v||0)+task.points);
  db.ref(`scores/WG`).transaction(v=>(v||0)+task.points);
  db.ref(`stats/${task.name}/${person}`).transaction(v=>(v||0)+1);
}

/* üîÑ Render */
db.ref("/").on("value",snap=>{
  const d=snap.val()||{};
  tasksTab.innerHTML="";
  statsTab.innerHTML="";

  /* Aufgaben Tab */
  tasks.forEach(t=>{
    const m=d.tasks?.[t.name]?.Maria?.last;
    const v=d.tasks?.[t.name]?.Valentin?.last;
    const lastBy = (!v || (m && m>v)) ? "Maria" : "Valentin";

    const el=document.createElement("div");
    el.className="task";
    el.innerHTML=`
      <div>
        <strong>${t.emoji} ${t.name}</strong> <br>
        Zuletzt erledigt: ${lastBy}<br>
        üë© ${fmt(m)} <span class="status" style="background:${color(days(m))}">vor ${days(m)} Tagen</span><br>
        üë® ${fmt(v)} <span class="status" style="background:${color(days(v))}">vor ${days(v)} Tagen</span>
      </div>
      <div>
        <button class="maria" onclick='done(${JSON.stringify(t)},"Maria")'>Maria ‚úî</button><br><br>
        <button class="valentin" onclick='done(${JSON.stringify(t)},"Valentin")'>Valentin ‚úî</button>
      </div>`;
    tasksTab.appendChild(el);
  });

  /* Statistik Tab */
  statsTab.innerHTML=`
    <button class="reset-btn" onclick="resetStats()">Statistiken zur√ºcksetzen</button>
    <table>
      <tr><th>Aufgabe</th><th>Maria</th><th>Valentin</th></tr>
  `;
  tasks.forEach(t=>{
    const m=d.stats?.[t.name]?.Maria||0;
    const v=d.stats?.[t.name]?.Valentin||0;
    statsTab.innerHTML+=`<tr><td>${t.name}</td><td>${m}</td><td>${v}</td></tr>`;
  });
  statsTab.innerHTML+="</table>";
});

/* Reset Statistik */
function resetStats(){
  if(confirm("Willst du wirklich alle Statistiken zur√ºcksetzen?")){
    db.ref("stats").set(null);
  }
}

/* Tabs */
function showTab(id){
  tasksTab.style.display = (id==="tasksTab") ? "block":"none";
  statsTab.style.display = (id==="statsTab") ? "block":"none";
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  event.currentTarget.classList.add("active");
}

const tasksTab=document.getElementById("tasksTab");
const statsTab=document.getElementById("statsTab");
</script>

</body>
</html>
