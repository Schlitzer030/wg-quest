<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WG Quest Board ğŸ”¥</title>

<!-- Firebase COMPAT (wichtig!) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: linear-gradient(135deg, #fdfbfb, #ebedee);
    padding: 20px;
  }
  h1 { text-align: center; }

  .scores {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    font-size: 16px;
  }

  .task {
    background: white;
    padding: 15px;
    margin-bottom: 12px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  button {
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    color: white;
  }

  .maria { background: #e91e63; }
  .valentin { background: #3f51b5; }
</style>
</head>

<body>

<h1>ğŸ  WG Quest Board</h1>

<div class="scores">
  <div>ğŸ‘© Maria â­ <span id="scoreMaria">0</span></div>
  <div>ğŸ¤ WG â­ <span id="scoreWG">0</span></div>
  <div>ğŸ‘¨ Valentin â­ <span id="scoreValentin">0</span></div>
</div>

<div id="tasks"></div>

<script>
/* ğŸ”¥ FIREBASE KONFIGURATION */
const firebaseConfig = {
  apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
  authDomain: "wg-quest.firebaseapp.com",
  databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wg-quest",
  storageBucket: "wg-quest.appspot.com",
  messagingSenderId: "171906625585",
  appId: "1:171906625585:web:d7c618e3d7b70e72a2a510"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ğŸ‘¥ Personen */
const persons = ["Maria", "Valentin"];

/* ğŸ§¹ Aufgaben */
const tasks = [
  { name: "Staubsaugen", emoji: "ğŸ§¹", points: 15 },
  { name: "Wischen", emoji: "ğŸª£", points: 20 },
  { name: "Bad putzen", emoji: "ğŸš¿", points: 25 },
  { name: "SpÃ¼lmaschine", emoji: "ğŸ½ï¸", points: 5 },
  { name: "WÃ¤sche", emoji: "ğŸ§º", points: 10 },
  { name: "AufrÃ¤umen", emoji: "ğŸ“¦", points: 15 }
];

/* âœ” Aufgabe erledigt */
function markDone(task, person) {
  const now = Date.now();
  const ref = db.ref(`tasks/${task.name}/${person}`);

  ref.once("value").then(snapshot => {
    const data = snapshot.val() || { last: 0, streak: 0 };
    const streak = (now - data.last < 86400000) ? data.streak + 1 : 1;
    const earned = task.points + streak * 2;

    ref.set({ last: now, streak });

    db.ref(`scores/${person}`).transaction(v => (v || 0) + earned);
    db.ref("scores/WG").transaction(v => (v || 0) + earned);
  });
}

/* ğŸ”„ Render */
function render(snapshot) {
  const data = snapshot.val() || {};

  document.getElementById("scoreMaria").innerText = data.scores?.Maria || 0;
  document.getElementById("scoreValentin").innerText = data.scores?.Valentin || 0;
  document.getElementById("scoreWG").innerText = data.scores?.WG || 0;

  const container = document.getElementById("tasks");
  container.innerHTML = "";

  tasks.forEach(task => {
    const div = document.createElement("div");
    div.className = "task";
    div.innerHTML = `
      <div><strong>${task.emoji} ${task.name}</strong></div>
      <div>
        <button class="maria" onclick='markDone(${JSON.stringify(task)},"Maria")'>Maria âœ”</button>
        <button class="valentin" onclick='markDone(${JSON.stringify(task)},"Valentin")'>Valentin âœ”</button>
      </div>
    `;
    container.appendChild(div);
  });
}

/* ğŸ‘‚ Live-Sync */
db.ref("/").on("value", render);
</script>

</body>
</html>
