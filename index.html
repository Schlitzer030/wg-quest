<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WG Quest üè†</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#f3f3f3;
  margin:0;
  padding:0;
}
h1 { text-align:center; margin:10px 0; }

.tabs {
  display:flex;
}
.tab {
  flex:1;
  padding:12px;
  text-align:center;
  font-weight:bold;
  background:#ddd;
}
.tab.active { background:#bbb; }

.section { padding:10px; }

.task {
  background:white;
  padding:12px;
  margin-bottom:10px;
  border-radius:14px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

.task-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.task-meta {
  font-size:12px;
  opacity:.8;
}

button {
  border:none;
  border-radius:8px;
  padding:6px 10px;
  color:white;
  cursor:pointer;
}
.maria { background:#e91e63; }
.valentin { background:#3f51b5; }
.undo { background:#9e9e9e; }

table {
  width:100%;
  border-collapse:collapse;
  background:white;
  margin-top:20px;
}
th, td {
  border-bottom:1px solid #ddd;
  padding:6px;
  font-size:12px;
  text-align:center;
}
th { background:#eee; }

.reset {
  background:#f44336;
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:10px;
}
</style>
</head>

<body>

<h1>üè† WG Quest</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab('tasks')">Aufgaben</div>
  <div class="tab" onclick="showTab('stats')">Statistik</div>
</div>

<!-- TASKS -->
<div id="tasks" class="section">
  <div id="taskList"></div>
</div>

<!-- STATS -->
<div id="stats" class="section" style="display:none">
  <canvas id="pieChart" height="260"></canvas>

  <button class="reset" onclick="resetStats()">üîÑ Statistiken zur√ºcksetzen</button>

  <table>
    <thead>
      <tr>
        <th>Aufgabe</th>
        <th>Maria</th>
        <th>Valentin</th>
        <th>Gesamt</th>
      </tr>
    </thead>
    <tbody id="statTable"></tbody>
  </table>
</div>

<script>
/* üî• Firebase */
firebase.initializeApp({
  apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
  databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app"
});
const db = firebase.database();

/* üßπ TASKS */
const tasks = [
  {n:"Sp√ºlmaschine einr√§umen",e:"üçΩÔ∏è",c:"daily"},
  {n:"Sp√ºlmaschine ausr√§umen",e:"ü•Ñ",c:"daily"},
  {n:"M√ºll rausbringen",e:"üóëÔ∏è",c:"daily"},
  {n:"W√§sche aufh√§ngen",e:"üëï",c:"daily"},
  {n:"W√§sche abh√§ngen",e:"üß∫",c:"daily"},
  {n:"K√ºchenablagen wischen",e:"üç≥",c:"daily"},
  {n:"Kochen",e:"üç≤",c:"daily"},

  {n:"Staub wischen",e:"üßΩ",c:"weekly"},
  {n:"Bad putzen",e:"üöø",c:"weekly"},
  {n:"Boden wischen",e:"ü™£",c:"weekly"},
  {n:"Fenster putzen",e:"ü™ü",c:"weekly"},
  {n:"Glasm√ºll rausbringen",e:"üçæ",c:"weekly"},
  {n:"Einkaufen",e:"üõí",c:"weekly"},
  {n:"Blumen gie√üen",e:"üå∏",c:"weekly"},
  {n:"Bett beziehen",e:"üõèÔ∏è",c:"weekly"},

  {n:"Pfand wegbringen",e:"‚ôªÔ∏è",c:"monthly"},
  {n:"K√ºhlschrank auswischen",e:"‚ùÑÔ∏è",c:"monthly"},
  {n:"Deep Clean",e:"üß®",c:"monthly"},
  {n:"Waschmaschine reinigen",e:"üßº",c:"monthly"},
  {n:"Sp√ºlmaschine reinigen",e:"üßΩ",c:"monthly"}
];

function showTab(id){
  tasksDiv.style.display = id==="tasks"?"block":"none";
  stats.style.display = id==="stats"?"block":"none";
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  event.currentTarget.classList.add("active");
}

function markDone(task, person){
  const now = Date.now();
  db.ref(`history/${task.n}`).set({person, time:now});
  db.ref(`stats/${task.n}/${person}`).transaction(v=>(v||0)+1);
  render();
}

function undo(task){
  db.ref(`history/${task.n}`).remove();
}

function render(){
  const list = document.getElementById("taskList");
  list.innerHTML="";

  db.ref("history").once("value").then(s=>{
    const hist=s.val()||{};
    tasks.forEach(t=>{
      const h=hist[t.n];
      const days = h?Math.floor((Date.now()-h.time)/86400000):0;
      const div=document.createElement("div");
      div.className="task";
      div.innerHTML=`
        <div class="task-header">
          <strong>${t.e} ${t.n}</strong>
          <span class="task-meta">${h?`zuletzt: ${h.person} ¬∑ vor ${days} Tagen`:"noch nie"}</span>
        </div>
        <div style="margin-top:8px">
          <button class="maria" onclick='markDone(${JSON.stringify(t)},"Maria")'>Maria ‚úî</button>
          <button class="valentin" onclick='markDone(${JSON.stringify(t)},"Valentin")'>Valentin ‚úî</button>
          <button class="undo" onclick='undo(${JSON.stringify(t)})'>‚Ü©</button>
        </div>
      `;
      list.appendChild(div);
    });
  });

  renderStats();
}

let chart;
function renderStats(){
  db.ref("stats").once("value").then(s=>{
    const data=s.val()||{};
    let maria=0,valentin=0;
    const tbody=document.getElementById("statTable");
    tbody.innerHTML="";

    Object.keys(data).forEach(task=>{
      const m=data[task].Maria||0;
      const v=data[task].Valentin||0;
      maria+=m; valentin+=v;
      tbody.innerHTML+=`
        <tr>
          <td>${task}</td>
          <td>${m}</td>
          <td>${v}</td>
          <td>${m+v}</td>
        </tr>`;
    });

    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("pieChart"),{
      type:"pie",
      data:{
        labels:["Maria","Valentin"],
        datasets:[{
          data:[maria,valentin],
          backgroundColor:["#e91e63","#3f51b5"]
        }]
      }
    });
  });
}

function resetStats(){
  if(confirm("Statistiken wirklich l√∂schen?")){
    db.ref("stats").remove();
  }
}

render();
</script>

</body>
</html>
