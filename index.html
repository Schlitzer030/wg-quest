<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WG Quest</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#f2f4f7;
}
header {
  text-align:center;
  padding:14px;
  font-weight:700;
  font-size:20px;
}
.tabs {
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:white;
  border-top:1px solid #ddd;
}
.tab {
  flex:1;
  text-align:center;
  padding:10px;
  font-size:12px;
}
.section {
  padding:12px;
  padding-bottom:70px;
}
.room {
  background:white;
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.task {
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:#f7f7f7;
  border-left:6px solid green;
}
.task.overdue {
  border-left-color:red;
  background:#ffecec;
}
.meta {
  font-size:12px;
  opacity:.7;
}
.buttons {
  margin-top:6px;
}
button {
  border:none;
  border-radius:8px;
  padding:6px 10px;
  color:white;
}
.maria { background:#e91e63; }
.valentin { background:#3f51b5; }
</style>
</head>

<body>

<header>üè† WG Quest</header>

<div id="rooms" class="section"></div>

<div class="tabs">
  <div class="tab">üè† R√§ume</div>
  <div class="tab">üìã Aufgaben</div>
  <div class="tab">üìä Stats</div>
  <div class="tab">‚öôÔ∏è</div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCRfZuJ-DQpmB-TEa7h2S_PHhal6JBy4KI",
  databaseURL: "https://wg-quest-default-rtdb.europe-west1.firebasedatabase.app"
});
const db = firebase.database();

const rooms = {
  K√ºche: ["Sp√ºlmaschine einr√§umen","Sp√ºlmaschine ausr√§umen","K√ºchenablagen wischen","M√ºll rausbringen"],
  Bad: ["Bad putzen","Staub wischen","Fenster putzen"],
  Wohnzimmer: ["Staub wischen","Boden wischen"],
  Schlafzimmer: ["Bett beziehen","W√§sche aufh√§ngen","W√§sche abh√§ngen"]
};

function colorByDays(days){
  if(days<=1) return "green";
  if(days<=3) return "lightgreen";
  if(days<=5) return "orange";
  return "red";
}

function mark(task, person){
  db.ref("history/"+task).set({by:person,time:Date.now()});
  render();
}

function render(){
  const root=document.getElementById("rooms");
  root.innerHTML="";
  db.ref("history").once("value").then(s=>{
    const h=s.val()||{};
    Object.keys(rooms).forEach(room=>{
      const div=document.createElement("div");
      div.className="room";
      div.innerHTML=`<h3>${room}</h3>`;
      rooms[room].forEach(t=>{
        const d=h[t];
        const days=d?Math.floor((Date.now()-d.time)/86400000):999;
        const task=document.createElement("div");
        task.className="task"+(days>7?" overdue":"");
        task.style.borderLeftColor=colorByDays(days);
        task.innerHTML=`
          <strong>${t}</strong>
          <div class="meta">
            ${d?`zuletzt ${d.by}, vor ${days} Tagen`:"noch nie"} ${days>7?"‚ö†Ô∏è":""}
          </div>
          <div class="buttons">
            <button class="maria" onclick="mark('${t}','Maria')">Maria</button>
            <button class="valentin" onclick="mark('${t}','Valentin')">Valentin</button>
          </div>
        `;
        div.appendChild(task);
      });
      root.appendChild(div);
    });
  });
}
render();
</script>

</body>
</html>
